# Evita mostrar errores al usuario
php_flag display_errors Off

# Seguridad básica contra navegación de directorios
Options -Indexes

# Bloqueo de archivos sensibles
<FilesMatch "^.*\.(env|json|lock|gitignore|htaccess|htpasswd|ini|log|sql|sh|bak|inc|old)$">
  Order allow,deny
  Deny from all
</FilesMatch>

# Bloqueo de ejecución PHP en carpetas sensibles
<Directory "/uploads/">
  <FilesMatch "\.php$">
    Order allow,deny
    Deny from all
  </FilesMatch>
</Directory>

# Evitar acceso a carpetas del sistema o del proyecto
RedirectMatch 403 ^/(vendor|node_modules|composer\.json|composer\.lock|package\.json|webpack\.config\.js)$

# Protección contra Hotlinking de imágenes
RewriteEngine On
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !^https://(www\.)?pulcast\.com [NC]
RewriteRule \.(jpg|jpeg|png|gif)$ - [F]

# Cabeceras de seguridad
Header always set X-Content-Type-Options "nosniff"
Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set Permissions-Policy "accelerometer=(), camera=(), geolocation=(), microphone=(), usb=()"
Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"

# Limita acceso a bots agresivos
BrowserMatchNoCase "AhrefsBot" bad_bot
BrowserMatchNoCase "SemrushBot" bad_bot
Order Allow,Deny
Allow from all
Deny from env=bad_bot

# Prevención de ataques simples por URL (inyección básica)
RewriteCond %{QUERY_STRING} (\.\.\/|base64_encode|select|insert|union|drop|update|delete) [NC]
RewriteRule ^.*$ - [F,L]
